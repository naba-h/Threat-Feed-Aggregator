<script>
const API = "https://threat-feed-aggregator.hanfinaba.workers.dev";

async function scanIP() {
  const ip = document.getElementById("ipInput").value.trim();
  if (!ip) {
    alert("Please enter an IP address");
    return;
  }

  setLoading(true);

  try {
    const res = await fetch(`${API}/?ip=${ip}`);
    const data = await res.json();

    if (data.error) {
      throw new Error(data.error);
    }

    document.getElementById("abuse").innerText =
      data.feeds?.abuseipdb?.abuseConfidenceScore ?? "0";

    document.getElementById("country").innerText =
      data.geo?.country ?? "Unknown";

    document.getElementById("isp").innerText =
      data.geo?.isp ?? "Unknown";

    document.getElementById("status").innerText = data.risk;
    document.getElementById("score").innerText = data.threat_score;

    setLoading(false);
  } catch (e) {
    alert("Backend unreachable or error");
    console.error(e);
    setLoading(false);
  }
}

function setLoading(on) {
  document.getElementById("status").innerText = on ? "Scanning…" : "--";
  document.getElementById("abuse").innerText = on ? "…" : "--";
  document.getElementById("country").innerText = on ? "…" : "--";
  document.getElementById("isp").innerText = on ? "…" : "--";
  document.getElementById("score").innerText = on ? "…" : "--";
}
</script>
