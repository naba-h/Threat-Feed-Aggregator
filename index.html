<script>
const API = "https://threat-feed-aggregator.hanfibaba.workers.dev";

async function scanIP() {
  const ip = document.getElementById("ip").value.trim();
  if (!ip) return alert("Enter IP");

  setLoading();

  try {
    const res = await fetch(`${API}/?ip=${ip}`);
    const data = await res.json();

    if (data.error) throw data.error;

    render(data);
  } catch (e) {
    alert("Backend not reachable");
  }
}

function setLoading() {
  set("threat", "Scanning...");
  set("score", "--");
  set("abuse", "--");
  set("country", "--");
  set("isp", "--");
  set("ports", "--");
  set("confidence", "--");
}

function set(id, val) {
  document.getElementById(id).innerText = val;
}

function render(d) {
  set("threat", d.risk);
  set("score", d.threat_score);
  set("abuse", d.feeds.abuseipdb?.abuseConfidenceScore || 0);
  set("country", d.geo.country);
  set("isp", d.geo.isp);
  set("ports", d.feeds.shodan?.open_ports?.join(", ") || "None");
  set("confidence", d.confidence);
}
</script>
