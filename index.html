<script>
const API = "https://threat-feed-aggregator.hanfibaba.workers.dev";

async function analyze() {
  const ip = document.getElementById("ipInput").value.trim();
  if (!ip) return alert("Enter IP");

  setLoading();

  try {
    const r = await fetch(`${API}?ip=${ip}`);
    const data = await r.json();

    if (data.error) throw new Error(data.error);

    document.getElementById("threatLevel").innerText = data.verdict;
    document.getElementById("threatScore").innerText = data.threat_score;
    document.getElementById("confidence").innerText = data.confidence + "%";

    document.getElementById("country").innerText =
      data.sources.virustotal?.country || "Unknown";

    document.getElementById("isp").innerText =
      data.sources.shodan?.isp || "Unknown";

    document.getElementById("ports").innerText =
      (data.sources.shodan?.ports || []).join(", ") || "None";

  } catch (e) {
    document.getElementById("threatLevel").innerText = "Backend unreachable";
    document.getElementById("threatScore").innerText = "—";
    document.getElementById("confidence").innerText = "—";
    document.getElementById("country").innerText = "—";
    document.getElementById("isp").innerText = "—";
    document.getElementById("ports").innerText = "—";
  }
}

function setLoading() {
  document.getElementById("threatLevel").innerText = "Loading…";
  document.getElementById("threatScore").innerText = "…";
  document.getElementById("confidence").innerText = "…";
  document.getElementById("country").innerText = "…";
  document.getElementById("isp").innerText = "…";
  document.getElementById("ports").innerText = "…";
}
</script>
